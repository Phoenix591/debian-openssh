From db9906f64cfee403b9c68d5bae5cc893ce4e1d94 Mon Sep 17 00:00:00 2001
From: Damien Miller <djm@mindrot.org>
Date: Thu, 9 Oct 2025 10:07:40 +1100
Subject: link ssh-keygen directly against ssh-pkcs11.c

Matches what OpenBSD does and fixes ssh-keygen regression in
certifying keys using a CA key hosted via ssh-agent (bz3877)

Origin: upstream, https://anongit.mindrot.org/openssh.git/commit/?id=3470f465c6f5c7c371e73927ebb403dd7ba05893
Bug: https://bugzilla.mindrot.org/show_bug.cgi?id=3877
Last-Update: 2025-10-09

Patch-Name: link-ssh-keygen-against-ssh-pkcs11.patch
---
 Makefile.in | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/Makefile.in b/Makefile.in
index 9310d4518..6ad81e78b 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -158,7 +158,7 @@ SSHADD_OBJS=	ssh-add.o $(P11OBJS) $(SKOBJS)
 
 SSHAGENT_OBJS=	ssh-agent.o $(P11OBJS) $(SKOBJS)
 
-SSHKEYGEN_OBJS=	ssh-keygen.o sshsig.o $(P11OBJS) $(SKOBJS)
+SSHKEYGEN_OBJS=	ssh-keygen.o sshsig.o ssh-pkcs11.o $(SKOBJS)
 
 SSHKEYSIGN_OBJS=ssh-keysign.o readconf.o uidswap.o $(P11OBJS) $(SKOBJS)
 
